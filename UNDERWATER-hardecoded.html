<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hidden Object Adventure Pro</title>
  <style>
    /* Reset and full screen styles */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    
    /* --- ASPECT RATIO WRAPPER FOR RESPONSIVENESS --- */
    body {
        background: #000;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    #aspect-ratio-wrapper {
        position: relative;
        width: 100vw;
        height: 56.25vw; /* 16:9 aspect ratio */
        max-height: 100vh;
        max-width: 177.78vh; /* 16:9 -- 100 * 16 / 9 */
    }

    /* --- INITIAL CONTROLS & HIGH SCORES --- */
    #initial-controls {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
      background: rgba(40, 40, 40, 0.98);
      color: white; padding: 25px; border-radius: 12px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.5);
      width: 90%; max-width: 600px;
      display: flex; gap: 20px;
    }
    #start-panel { 
        flex: 1; text-align: center;
    }
    #initial-controls h2 { margin-bottom: 20px; text-align: center; }
    #initial-controls p { margin-bottom: 25px; color: #ccc; }
    #initial-controls button { 
        padding: 15px 30px; 
        width: 80%; 
        font-size: 1.5em; 
        background-color: #00aaff; 
        color: white; 
        border: none; 
        border-radius: 8px; 
        cursor: pointer; 
        transition: background-color 0.3s;
    }
    #initial-controls button:hover { background-color: #0088cc; }

    /* High Score Display */
    #high-scores { flex-basis: 200px; padding-left: 20px; border-left: 1px solid #555; }
    #high-scores h3 { color: #ffeb3b; }
    #high-scores ol { list-style-type: decimal; padding-left: 20px; }
    #high-scores li { margin: 5px 0; }
    #high-scores span { font-weight: bold; color: #fff; margin-right: 10px; }
    
    /* High Score Input Modal */
    #name-input-modal {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      z-index: 4000; background: rgba(20, 20, 20, 0.95);
      color: white; padding: 30px; border-radius: 10px;
      text-align: center; box-shadow: 0 0 40px rgba(0,0,0,0.7);
      display: none; /* Initially hidden */
    }
    #name-input-modal h3 { margin-bottom: 15px; }
    #name-input-modal input {
      font-size: 2em; width: 100px; text-align: center; text-transform: uppercase;
      margin-bottom: 20px; border: 2px solid #00aaff; background: #333; color: white;
    }
    #name-input-modal button { padding: 10px 20px; font-size: 1.1em; }

    /* --- VIDEO & ANIMATED TITLE OVERLAYS --- */
    #intro-video {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: black; z-index: 2000; object-fit: cover; display: none;
    }
    #title-page {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(45deg, #2c3e50, #fd746c, #ffb270, #2c3e50);
      background-size: 400% 400%; z-index: 3000;
      display: none; align-items: center; justify-content: center; text-align: center;
      flex-direction: column; animation: gradientBG 15s ease infinite;
    }
    @keyframes gradientBG { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    #title-page h1 { font-size: clamp(2.5em, 8vw, 6em); color: white; text-shadow: 4px 4px 10px rgba(0,0,0,0.6); animation: floatEffect 3s ease-in-out infinite; }
    @keyframes floatEffect { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
    #title-page p { margin-top: 20px; font-size: 1.2em; color: rgba(255, 255, 255, 0.8); animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }

    /* --- MAIN GAME AREA & OBJECTS --- */
    #game-container {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background-size: cover; background-position: center; cursor: crosshair;
    }
    .placed-object {
      position: absolute; user-select: none; width: 100px;
      transition: transform 0.5s ease, opacity 0.5s ease;
    }
    .placed-object.found-animated {
      animation: spinAndFly 1s forwards ease-in-out;
      pointer-events: none;
    }
    @keyframes spinAndFly {
      0% { transform: scale(1.1) rotate(0deg); filter: drop-shadow(0 0 15px yellow); opacity: 1; }
      100% { transform: scale(0) rotate(720deg) translateY(-600px); filter: drop-shadow(0 0 0 yellow); opacity: 0; }
    }
    /* Animated Mistake Feedback */
    .mistake-x {
      position: absolute; color: red; font-size: 8em;
      font-weight: bold; text-shadow: 0 0 10px black;
      pointer-events: none; user-select: none;
      transform: translate(-50%, -50%); /* Center on cursor */
      animation: fadeAndScaleOut 1s forwards;
      display: flex; flex-direction: column; align-items: center;
    }
    .mistake-x .mistake-text { font-size: 0.2em; margin-top: -15px; }
    @keyframes fadeAndScaleOut {
      0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
    }

    /* --- BOTTOM OBJECT GRID --- */
    #object-grid {
      position: absolute; bottom: 0; left:0; width: 100%;
      background: rgba(20, 20, 20, 0.7); backdrop-filter: blur(5px);
      display: flex; justify-content: space-evenly; flex-wrap: wrap;
      padding: 10px 5px; z-index: 1500;
    }
    #object-grid.hints-available .grid-item:not(:has(.found-overlay)) { cursor: help; }
    .grid-item {
      position: relative; flex: 0 0 100px; height: 100px;
      margin: 5px; border: 2px solid #ccc; border-radius: 4px; background-color: #333;
    }
    .grid-item img {
      width: 100%; height: 100%; display: block; object-fit: contain;
    }
    .found-overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      color: #ffeb3b; font-size: 5em; font-weight: bold; text-align: center;
      line-height: 100px; pointer-events: none; text-shadow: 2px 2px 5px rgba(0,0,0,0.8);
    }
    
    /* --- TOP GAME CONTROLS (ALWAYS VISIBLE) --- */
    #game-controls {
      position: absolute; top: 0; left: 0; width: 100%; z-index: 1100;
      display: flex; justify-content: space-between; align-items: center;
      gap: 20px; background: rgba(20, 20, 20, 0.7);
      backdrop-filter: blur(5px); padding: 10px 20px;
    }
    #game-controls .control-group { display: flex; align-items: center; gap: 10px; }
    #game-controls button {
      padding: 8px 15px; font-size: 1em; background-color: #555;
      color: white; border: 1px solid #777; border-radius: 5px; cursor: pointer;
    }
    #game-controls button:hover { background-color: #777; }
    .game-stat {
      font-size: 1.2em; color: #ffeb3b; font-weight: bold;
      text-shadow: 1px 1px 3px black; white-space: nowrap;
    }
    /* Bonus Round UI */
    #bonus-ui {
        display: none; /* Hidden by default */
        text-align: center; color: white;
    }
    #bonus-ui img { height: 40px; vertical-align: middle; margin: 0 10px; border: 2px solid yellow; }
  </style>
</head>
<body>

  <div id="aspect-ratio-wrapper">
    <audio id="sound-found" src="https://gseymour.com/demos/sounds/correct.mp3" preload="auto"></audio>
    <audio id="sound-mistake" src="https://gseymour.com/demos/sounds/mistake.mp3" preload="auto"></audio>
    <audio id="sound-win" src="https://gseymour.com/demos/sounds/win.mp3" preload="auto"></audio>

    <div id="initial-controls">
      <div id="start-panel">
        <h2>Underwater Adventure</h2>
        <p>Find the hidden objects shown at the bottom of the screen. Good luck!</p>
        <button id="start-btn">Start Game</button>
      </div>
      <div id="high-scores">
        <h3>Fastest Times</h3>
        <ol id="score-list"></ol>
      </div>
    </div>

    <div id="name-input-modal">
      <h3>New High Score!</h3>
      <p>Enter your initials (3 letters):</p>
      <input type="text" id="initials-input" maxlength="3">
      <button id="submit-score-btn">Save Score</button>
    </div>

    <video id="intro-video" playsinline></video>
    <div id="title-page">
      <h1></h1>
      <p id="skip-prompt"></p>
    </div>
    <div id="game-container"><div id="object-grid"></div></div>

    <div id="game-controls">
      <div class="control-group">
        <div id="mistake-counter" class="game-stat">Mistakes: 0/5</div>
        <div id="hint-counter" class="game-stat">Hints: 0</div>
      </div>
      <div id="bonus-ui"></div>
      <div class="control-group">
        <button id="fullscreen-btn">Fullscreen</button>
        <button id="shuffle-bg">Shuffle Background</button>
        <button id="shuffle-obj">Shuffle Objects</button>
        <button id="shuffle-both">Shuffle Both</button>
      </div>
      <div id="timer" class="game-stat">Time: 0s</div>
    </div>
  </div>

  <script>
    (function(){
      // --- START: HARD-CODED FILE LISTS ---
      // These are the relative paths to your files.
      // Make sure this HTML file is in the same root directory as the 'BACKGROUNDS', 'videos', and 'fish' folders.
      const backgroundPaths = [
        "BACKGROUNDS/c8ae183f-2f66-42f6-a4c3-ee4c345331b8.png", "BACKGROUNDS/1a67669d-c245-4c24-8d4f-04d4c57a6fb8.png", "BACKGROUNDS/69562eef-3fac-43fa-b9f9-fb9f74f9de63.png", "BACKGROUNDS/9b95f7d9-84f8-484f-bce1-3fce5c16075b.png", "BACKGROUNDS/318e2c2c-8526-4852-b177-0f17f89d5013.png", "BACKGROUNDS/57948b35-2ff6-42ff-ae4a-1ae45d284f9c.png", "BACKGROUNDS/884eb185-79d7-479d-8966-2496d378d786.png", "BACKGROUNDS/vibrant_tropical_fish_in_various_colors_swimming (1).jpeg", "BACKGROUNDS/vibrant_tropical_fish_in_various_colors_swimming (4).jpeg", "BACKGROUNDS/vibrant_tropical_fish_in_various_colors_swimming (5).jpeg", "BACKGROUNDS/vibrant_tropical_fish_in_various_colors_swimming (6).jpeg", "BACKGROUNDS/vibrant_tropical_fish_in_various_colors_swimming (8).jpeg", "BACKGROUNDS/vibrant_tropical_fish_in_various_colors_swimming (10).jpeg", "BACKGROUNDS/vibrant_tropical_fish_in_various_colors_swimming (3).jpeg", "BACKGROUNDS/funbd (5).png", "BACKGROUNDS/funbd (6).png", "BACKGROUNDS/funbd (7).png", "BACKGROUNDS/bgyo.png", "BACKGROUNDS/68cbdbc1-6074-4607-be4f-83e490fca320.png", "BACKGROUNDS/b2be8b76-f123-4f12-bce7-63ceebbbc80e.png", "BACKGROUNDS/2d986d2c-bdf5-4bdf-8019-2801a6e82bd1.png", "BACKGROUNDS/fe6e242b-cd97-4cd9-a1e6-a61eba7db9ea.png", "BACKGROUNDS/8d12d76d-8578-4857-956c-b156677666fd.png", "BACKGROUNDS/1bc8c16e-5f31-45f3-aee4-d6ee714a89fa.png", "BACKGROUNDS/831af681-28d2-428d-ab0f-dab08b60ae0c.png", "BACKGROUNDS/c4974915-8ab1-48ab-a960-c6960b451c3e.png", "BACKGROUNDS/d3137cc1-7f28-47f2-8ab6-dcab7cc93ee4.png", "BACKGROUNDS/ed25a5ae-0b52-40b5-84ba-e44b807155fc.png", "BACKGROUNDS/8e6c004e-5923-4592-8b20-5cb264b8caf3.png", "BACKGROUNDS/24130f60-9931-4993-8c3e-10c3dede4003.png", "BACKGROUNDS/62025ffe-5784-4578-943d-6143b3eb28d9.png", "BACKGROUNDS/f607e616-fd99-4fd9-97ee-657e1548e6fe.png", "BACKGROUNDS/a_3d_rendered_underwater_scene_featuring_the_text_greg_seymour_ai_displayed_in_rainbow_gradient_col_62z5y57gcutklrp5zfnf_3.png", "BACKGROUNDS/1f9f4165-93aa-493a-a4e9-5e4e54177d87.png", "BACKGROUNDS/c3b57f16-513d-4513-b610-8f61813fe80b.png", "BACKGROUNDS/2ffcf991-7cf7-47cf-8a10-fca11fac2d53.png", "BACKGROUNDS/a5d30969-f4a7-4f4a-9a4c-bda4cbf42e46 (2).png", "BACKGROUNDS/71a386a7-f841-4f84-8b49-bcb4d2e0b0b1 (1).png", "BACKGROUNDS/90eee618-e210-4e21-9b73-f5b7ea65f7fd.png", "BACKGROUNDS/f8aba306-a595-4a59-b6e3-6b6efb847803.png", "BACKGROUNDS/e068835d-a57e-4a57-bb7e-2fb7e3194d62.png", "BACKGROUNDS/9fcefa55-cab5-4cab-b6d1-8f6dab68437d.png", "BACKGROUNDS/8b165e5e-a6f3-4a6f-946e-6d46686dcc12.png", "BACKGROUNDS/2610ffaa-b98d-4b98-a877-228755d1d10f.png", "BACKGROUNDS/8d30223c-7252-4725-8cd1-10cd5067655e.png", "BACKGROUNDS/18ff8a39-2c00-42c0-b7f5-c37f8034b786.png", "BACKGROUNDS/e5d3ad87-4b41-44b4-82ac-102a0a234a00.png", "BACKGROUNDS/342f8397-841e-4841-90ae-c90ae434e230.png", "BACKGROUNDS/Generated Image August 30, 2025 - 11_26PM.jpeg", "BACKGROUNDS/Generated Image August 30, 2025 - 11_23PM.jpeg", "BACKGROUNDS/Generated Image August 30, 2025 - 11_09PM.jpeg", "BACKGROUNDS/515381d1-16f2-416f-9cee-81ced143daeb.png"
      ];
      const videoPaths = [
        "videos/v (3).mp4", "videos/v (1).mp4", "videos/v (9).mp4", "videos/v (4).mp4", "videos/v (7).mp4", "videos/vv (4).mp4", "videos/v (6).mp4", "videos/Hailuo_Video_Starting point_ Low angle near_423867197365227523_cropped_converted.mp4", "videos/Hailuo_Video_Starting point_ Low angle near_423867197365227522_cropped_converted.mp4", "videos/Hailuo_Video_Visual_ Soft white halo surrou_423865484335919109_cropped_converted.mp4", "videos/Hailuo_Video_Visual_ Soft white halo surrou_423865484335919108_cropped_converted.mp4", "videos/Hailuo_Video_Lighting_ Slight ripple distor_423863987699224579_cropped_converted.mp4", "videos/Hailuo_Video_Lighting_ Slight ripple distor_423863251208818689_cropped_converted.mp4", "videos/Hailuo_Video_Lighting_ Slight ripple distor_423862595639070729_cropped_converted.mp4", "videos/Hailuo_Video_Environment_ Strong winds movi_423861752751779850_cropped_converted.mp4", "videos/Hailuo_Video_Environment_ Strong winds movi_423861752751779849_cropped_converted.mp4", "videos/Professional_Mode_the_monster_summons_you_forward - Trim_cropped_converted.mp4", "videos/Hailuo_Video_Visual elements_ _ Floating ro_423852476188655621_cropped_converted.mp4", "videos/Hailuo_Video_423851228295090182_cropped_converted.mp4", "videos/Hailuo_Video_423850434397278215_cropped_converted.mp4", "videos/Hailuo_Video_423849973770391552_cropped_converted.mp4", "videos/aaa (5)_converted.mp4", "videos/aaa (4)_converted.mp4", "videos/aaa (3)_converted.mp4", "videos/aaa (2)_converted.mp4", "videos/aaa (1)_converted.mp4", "videos/v (2).mp4"
      ];
      // Using fish for both hidden objects and decoys
      const fishPaths = [
        "fish/fishleft (1).png", "fish/fishleft (2).png", "fish/fishleft (3).png", "fish/fishleft (4).png", "fish/fishleft (5).png", "fish/fishleft (6).png", "fish/fishleft (7).png", "fish/fishleft (8).png", "fish/fishleft (9).png", "fish/fishleft (10).png", "fish/fishleft (11).png", "fish/fishleft (12).png", "fish/fishleft (13).png", "fish/fishleft (14).png", "fish/fishleft (15).png", "fish/fishleft (16).png", "fish/fishleft (17).png", "fish/fishleft (18).png", "fish/fishleft (19).png", "fish/fishleft (20).png", "fish/fishleft (21).png", "fish/fishleft (22).png", "fish/fishleft (23).png", "fish/fishleft (24).png", "fish/fishleft (25).png", "fish/fishleft (26).png", "fish/fishleft (27).png", "fish/fishleft (28).png", "fish/fishleft (29).png", "fish/fishleft (30).png", "fish/fishleft (31).png", "fish/fishleft (32).png", "fish/fishleft (33).png", "fish/fishleft (34).png", "fish/fishleft (35).png", "fish/fishleft (36).png", "fish/fishleft (37).png", "fish/fishleft (38).png", "fish/fishleft (39).png", "fish/fishleft (40).png", "fish/fishleft (41).png", "fish/fishleft (42).png", "fish/fishleft (43).png", "fish/fishleft (44).png", "fish/fishleft (45).png", "fish/fishleft (46).png", "fish/fishleft (47).png", "fish/fishleft (48).png", "fish/fishleft (49).png", "fish/fishleft (50).png", "fish/fishleft (51).png", "fish/fishleft (52).png", "fish/fishleft (53).png", "fish/fishleft (54).png", "fish/fishleft (55).png", "fish/fishleft (56).png", "fish/fishleft (57).png", "fish/fishleft (58).png", "fish/fishleft (59).png", "fish/fishleft (60).png", "fish/fishleft (61).png", "fish/fishleft (62).png", "fish/fishleft (63).png", "fish/fishleft (64).png", "fish/fishleft (65).png", "fish/fishleft (66).png", "fish/fishleft (67).png", "fish/fishleft (68).png", "fish/fishleft (69).png", "fish/fishleft (70).png", "fish/fishleft (71).png", "fish/fishleft (72).png", "fish/fishleft (73).png", "fish/fishleft (74).png", "fish/fishleft (75).png", "fish/fishleft (76).png", "fish/fishleft (77).png", "fish/fishleft (78).png", "fish/fishleft (79).png", "fish/fishleft (80).png", "fish/fishleft (81).png", "fish/fishleft (82).png", "fish/fishleft (83).png", "fish/fishleft (84).png", "fish/fishleft (85).png", "fish/fishleft (86).png", "fish/fishleft (87).png", "fish/fishleft (88).png", "fish/fishleft (89).png", "fish/fishleft (90).png", "fish/fishleft (91).png", "fish/fishleft (92).png", "fish/fishleft (93).png", "fish/fishleft (94).png", "fish/fishleft (95).png", "fish/fishleft (96).png", "fish/fishleft (97).png", "fish/fishleft (98).png", "fish/fishleft (99).png", "fish/fishleft (100).png"
      ];
      // --- END: HARD-CODED FILE LISTS ---


      // DOM Elements
      const initialControls = document.getElementById('initial-controls');
      const startBtn = document.getElementById('start-btn');
      const highScoresList = document.getElementById('score-list');
      const nameInputModal = document.getElementById('name-input-modal');
      const initialsInput = document.getElementById('initials-input');
      const submitScoreBtn = document.getElementById('submit-score-btn');
      const introVideo = document.getElementById('intro-video');
      const titlePage = document.getElementById('title-page');
      const skipPrompt = document.getElementById('skip-prompt');
      const gameContainer = document.getElementById('game-container');
      const objectGrid = document.getElementById('object-grid');
      const gameControls = document.getElementById('game-controls');
      const mistakeCounter = document.getElementById('mistake-counter');
      const hintCounter = document.getElementById('hint-counter');
      const timerDisplay = document.getElementById('timer');
      const bonusUI = document.getElementById('bonus-ui');
      const fullscreenBtn = document.getElementById('fullscreen-btn');
      const shuffleBgBtn = document.getElementById('shuffle-bg');
      const shuffleObjBtn = document.getElementById('shuffle-obj');
      const shuffleBothBtn = document.getElementById('shuffle-both');

      // Audio Elements
      const soundFound = document.getElementById('sound-found');
      const soundMistake = document.getElementById('sound-mistake');
      const soundWin = document.getElementById('sound-win');

      // Game State
      let bgFiles = [], objFiles = [], decoyFiles = [], videoFiles = [];
      let availableObjIndexes = [];
      const objectsPerRound = 10, decoysPerRound = 15, mistakesAllowed = 5;
      let mistakeCount = 0;
      let timerInterval;
      let secondsElapsed = 0;
      let currentScoreCallback = null;
      let hintCount = 0;
      let levelCount = 0;
      let isBonusRound = false;

      const winMessages = ["Great Job!", "Awesome!", "Level Complete!", "You're a Star!", "On to the Next!"];

      // --- HELPER FUNCTIONS ---
      function playSound(soundElement) {
        soundElement.currentTime = 0;
        soundElement.play().catch(e => console.log("Sound play failed:", e));
      }

      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }
      function goFullscreen() {
        const docElm = document.documentElement;
        if (docElm.requestFullscreen) docElm.requestFullscreen();
        else if (docElm.webkitRequestFullscreen) docElm.webkitRequestFullscreen();
      }

      function getRoundHiddenObjects() {
        if (availableObjIndexes.length < objectsPerRound) {
          availableObjIndexes = objFiles.map((_, i) => i);
          shuffleArray(availableObjIndexes);
        }
        const roundFiles = [];
        for (let i = 0; i < objectsPerRound; i++) {
          if (availableObjIndexes.length > 0) {
            roundFiles.push(objFiles[availableObjIndexes.pop()]);
          }
        }
        return roundFiles;
      }
      function getDecoyObjects() {
        shuffleArray(decoyFiles);
        return decoyFiles.slice(0, decoysPerRound);
      }
      
      // --- TIMER & HIGH SCORE FUNCTIONS ---
      function startTimer() {
        stopTimer();
        secondsElapsed = 0;
        timerDisplay.textContent = `Time: ${secondsElapsed}s`;
        timerInterval = setInterval(() => {
          secondsElapsed++;
          timerDisplay.textContent = `Time: ${secondsElapsed}s`;
        }, 1000);
      }
      function stopTimer() { clearInterval(timerInterval); }
      function getHighScores() { return JSON.parse(localStorage.getItem('hiddenObjectHighScores')) || []; }
      function saveHighScores(scores) {
        scores.sort((a, b) => a.time - b.time);
        const top10 = scores.slice(0, 10);
        localStorage.setItem('hiddenObjectHighScores', JSON.stringify(top10));
        displayHighScores();
      }
      function displayHighScores() {
        const scores = getHighScores();
        highScoresList.innerHTML = scores.map(s => `<li><span>${s.name}</span> ${s.time}s</li>`).join('');
        if (scores.length === 0) highScoresList.innerHTML = '<li>No scores yet!</li>';
      }
      function checkHighScore(time, onComplete) {
        const scores = getHighScores();
        if (scores.length < 10 || time < scores[scores.length - 1].time) {
          nameInputModal.style.display = 'block';
          initialsInput.focus();
          currentScoreCallback = () => {
            const name = initialsInput.value.trim().toUpperCase() || '???';
            scores.push({ name, time });
            saveHighScores(scores);
            nameInputModal.style.display = 'none';
            initialsInput.value = '';
            onComplete();
          };
        } else {
          onComplete();
        }
      }
      
      // --- CORE GAME FLOW FUNCTIONS ---
      function playInterludeVideo(callback) {
        if (videoFiles.length > 0) {
          let hasFinished = false;
          const finishVideo = () => {
            if (hasFinished) return;
            hasFinished = true;
            introVideo.style.display = 'none'; introVideo.pause();
            document.removeEventListener('keydown', handleSkipKey);
            callback();
          };
          const handleSkipKey = (e) => { if (e.code === 'Space') { e.preventDefault(); finishVideo(); } };
          const videoUrl = shuffleArray(videoFiles)[0]; // Changed
          introVideo.src = videoUrl; introVideo.style.display = 'block';
          introVideo.onended = finishVideo;
          introVideo.onerror = (e) => {
            console.error("Video Error:", e); alert("Could not play the selected video file. Skipping.");
            finishVideo();
          };
          document.addEventListener('keydown', handleSkipKey);
          const playPromise = introVideo.play();
          if (playPromise !== undefined) {
            playPromise.catch(error => {
              console.error("Video Autoplay Error:", error); alert("Video could not autoplay. Skipping.");
              finishVideo();
            });
          }
        } else {
          callback();
        }
      }

      function showTitlePage(message, callback, showSkip = false) {
        titlePage.querySelector('h1').textContent = message;
        skipPrompt.textContent = showSkip ? "Press Space to Skip" : "";
        titlePage.style.display = 'flex';
        setTimeout(() => {
          titlePage.style.display = 'none';
          callback();
        }, 2500);
      }

      function setRandomBackground() {
        if (bgFiles.length === 0) return;
        const randomBgFile = bgFiles[Math.floor(Math.random() * bgFiles.length)];
        gameContainer.style.backgroundImage = `url('${randomBgFile}')`; // Changed
      }
      function updateMistakeCounter() {
        mistakeCounter.textContent = `Mistakes: ${mistakeCount}/${mistakesAllowed}`;
        mistakeCounter.style.color = (mistakeCount >= mistakesAllowed) ? '#ff4d4d' : '#ffeb3b';
      }
      function updateHintCounter() {
        hintCounter.textContent = `Hints: ${hintCount}`;
        objectGrid.classList.toggle('hints-available', hintCount > 0);
      }
      function handleMistake(e) {
        if (isBonusRound || mistakeCount >= mistakesAllowed) return;
        playSound(soundMistake);
        
        const x = document.createElement('div');
        x.classList.add('mistake-x');
        x.innerHTML = `X <span class="mistake-text">${mistakesAllowed - (mistakeCount + 1)} left</span>`;
        x.style.left = `${e.clientX - gameContainer.getBoundingClientRect().left}px`;
        x.style.top = `${e.clientY - gameContainer.getBoundingClientRect().top}px`;
        gameContainer.appendChild(x);
        setTimeout(() => x.remove(), 1000);

        mistakeCount++;
        updateMistakeCounter();
        if (mistakeCount >= mistakesAllowed) {
            stopTimer();
            setTimeout(() => {
                alert("Game Over! Too many mistakes. Starting a new round.");
                loadNewRound();
            }, 100);
        }
      }

      function placeObjectsAndGrid() {
        isBonusRound = false;
        document.querySelectorAll('.placed-object, .mistake-x').forEach(el => el.remove());
        objectGrid.innerHTML = '';
        mistakeCount = 0;
        updateMistakeCounter();
        updateHintCounter();
        startTimer();

        const realObjFiles = getRoundHiddenObjects();
        const decoyObjFiles = getDecoyObjects();
        
        let objectsToPlace = [
            ...realObjFiles.map(path => ({ path, isReal: true, filename: path.split('/').pop() })),
            ...decoyObjFiles.map(path => ({ path, isReal: false, filename: path.split('/').pop() }))
        ];
        shuffleArray(objectsToPlace);

        const containerRect = gameContainer.getBoundingClientRect();
        const safeHeight = containerRect.height - 150;
        let foundCount = 0;

        function checkRoundComplete() {
          if (foundCount >= realObjFiles.length) {
            stopTimer();
            playSound(soundWin);
            levelCount++;
            hintCount++;
            updateHintCounter();
            
            const roundCompleteContinuation = () => {
              if (levelCount % 3 === 0) {
                 startBonusRound();
              } else {
                const randomMessage = winMessages[Math.floor(Math.random() * winMessages.length)];
                showTitlePage(randomMessage, () => playInterludeVideo(loadNewRound));
              }
            };
            checkHighScore(secondsElapsed, roundCompleteContinuation);
          }
        }

        objectsToPlace.forEach(obj => {
          const imgElem = document.createElement('img');
          imgElem.src = obj.path; // Changed
          imgElem.classList.add('placed-object');
          imgElem.dataset.filename = obj.filename;
          
          const maxX = containerRect.width - 100;
          const maxY = safeHeight - 100;
          imgElem.style.left = `${Math.floor(Math.random() * (maxX > 0 ? maxX : 1))}px`;
          imgElem.style.top = `${Math.floor(Math.random() * (maxY > 0 ? maxY : 1))}px`;
          
          imgElem.addEventListener('click', function(e) {
            e.stopPropagation();
            if (imgElem.classList.contains('found-animated')) return;
            if (obj.isReal) {
              playSound(soundFound);
              imgElem.classList.add('found-animated');
              
              const gridItem = document.querySelector(`.grid-item[data-filename="${obj.filename}"]`);
              if (gridItem && !gridItem.querySelector('.found-overlay')) {
                  const overlay = document.createElement('span');
                  overlay.classList.add('found-overlay');
                  overlay.textContent = "X";
                  gridItem.appendChild(overlay);
              }
              foundCount++;
              setTimeout(checkRoundComplete, 500);
            } else {
              handleMistake(e);
            }
          });
          gameContainer.appendChild(imgElem);
        });

        realObjFiles.forEach(objPath => {
            const gridItem = document.createElement('div');
            gridItem.classList.add('grid-item');
            const filename = objPath.split('/').pop();
            gridItem.dataset.filename = filename;
            const gridImg = document.createElement('img');
            gridImg.src = objPath; // Changed
            gridItem.appendChild(gridImg);
            gridItem.addEventListener('click', () => {
                if (hintCount > 0 && !gridItem.querySelector('.found-overlay')) {
                    hintCount--;
                    updateHintCounter();
                    const targetObject = document.querySelector(`.placed-object[data-filename="${filename}"]`);
                    if (targetObject) targetObject.click();
                }
            });
            objectGrid.appendChild(gridItem);
        });
      }

      function startBonusRound() {
        showTitlePage("BONUS ROUND!", () => {
            isBonusRound = true;
            document.querySelectorAll('.placed-object').forEach(el => el.remove());
            objectGrid.innerHTML = '';
            setRandomBackground();

            const bonusObjectPath = objFiles[Math.floor(Math.random() * objFiles.length)]; // Changed
            let bonusFoundCount = 0;
            
            bonusUI.innerHTML = `Find as many <img src="${bonusObjectPath}"> as you can!`; // Changed
            bonusUI.style.display = 'block';
            mistakeCounter.style.display = 'none';

            const containerRect = gameContainer.getBoundingClientRect();
            const safeHeight = containerRect.height - 150;

            for (let i = 0; i < 30; i++) {
                const imgElem = document.createElement('img');
                imgElem.src = bonusObjectPath; // Changed
                imgElem.classList.add('placed-object');
                const maxX = containerRect.width - 100;
                const maxY = safeHeight - 100;
                imgElem.style.left = `${Math.floor(Math.random() * (maxX > 0 ? maxX : 1))}px`;
                imgElem.style.top = `${Math.floor(Math.random() * (maxY > 0 ? maxY : 1))}px`;
                imgElem.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (imgElem.classList.contains('found-animated')) return;
                    playSound(soundFound);
                    bonusFoundCount++;
                    imgElem.classList.add('found-animated');
                    bonusUI.innerHTML = `Found: ${bonusFoundCount}`;
                });
                gameContainer.appendChild(imgElem);
            }

            let bonusTime = 30;
            timerDisplay.textContent = `Time: ${bonusTime}s`;
            const bonusTimer = setInterval(() => {
                bonusTime--;
                timerDisplay.textContent = `Time: ${bonusTime}s`;
                if (bonusTime <= 0) {
                    clearInterval(bonusTimer);
                    endBonusRound(bonusFoundCount);
                }
            }, 1000);
        });
      }

      function endBonusRound(foundCount) {
        bonusUI.style.display = 'none';
        mistakeCounter.style.display = 'flex';
        playSound(soundWin);
        showTitlePage(`You found ${foundCount} items!`, () => {
            playInterludeVideo(loadNewRound);
        });
      }
      
      function loadNewRound() { setRandomBackground(); placeObjectsAndGrid(); }
      
      // --- EVENT LISTENERS ---
      
      startBtn.addEventListener('click', () => {
        // Load files from the hard-coded arrays
        bgFiles = backgroundPaths;
        objFiles = fishPaths;
        decoyFiles = fishPaths; // Using fish for decoys as well
        videoFiles = videoPaths;

        if (bgFiles.length === 0 || objFiles.length < objectsPerRound || decoyFiles.length < decoysPerRound) {
          alert(`Error: Not enough assets were hard-coded.\n- Need at least 1 Background Image\n- Need at least ${objectsPerRound} Hidden Object Images\n- Need at least ${decoysPerRound} Decoy Images`);
          return;
        }
        availableObjIndexes = objFiles.map((_, i) => i);
        shuffleArray(availableObjIndexes);
        levelCount = 0;
        hintCount = 0;

        initialControls.style.display = 'none';
        goFullscreen();

        playInterludeVideo(() => {
          showTitlePage("Hidden Object Adventure Pro", loadNewRound, true);
        });
      });

      submitScoreBtn.addEventListener('click', () => { if (currentScoreCallback) currentScoreCallback(); });
      initialsInput.addEventListener('keyup', (e) => { if (e.key === 'Enter' && currentScoreCallback) currentScoreCallback(); });
      gameContainer.addEventListener('click', (e) => { if (e.target === gameContainer) handleMistake(e); });
      
      fullscreenBtn.addEventListener('click', goFullscreen);
      shuffleBgBtn.addEventListener('click', setRandomBackground);
      shuffleObjBtn.addEventListener('click', placeObjectsAndGrid);
      shuffleBothBtn.addEventListener('click', loadNewRound);
      
      // Initialize
      displayHighScores();
    })();
  </script>
</body>
</html>